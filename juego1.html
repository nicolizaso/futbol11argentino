<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Jugadores en Común - Fútbol 11 Argentino</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Anton&family=Rubik&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>
  <header>Fútbol 11 Argentino</header>

  <div class="container" id="introContainer">
    <h1 class="titulo-juego">JUGADORES EN COMÚN</h1>
    <div class="intro-flex">
      <img src="img/logos juegos/IMG-Juego1.jpg" alt="Imagen Juego 1" class="intro-img">
      <div class="intro-texto">
        <h2>¿Cómo se juega?</h2>
        <p>Tu misión es encontrar jugadores que hayan jugado en los dos equipos presentados. Tené cuidado: algunos nombres pueden engañar.</p>
        <p>Seleccioná un modo de juego:</p>
        <div class="modo-selector">
          <div class="modo-buttons">
            <button id="modoNormal" class="unselected">Desafío Diario</button>
            <button onclick="window.location.href='juego1-niveles.html'" class="unselected">Niveles</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="container" id="juegoContainer" style="display: none;">
    <div style="display: flex; justify-content: center; align-items: center; gap: 20px;">
      <div style="text-align: center;">
        <img id="escudo1" src="" alt="Equipo 1" style="width: 60px; height: 60px;"><br>
        <span id="nombreEquipo1"></span>
      </div>
      <strong>vs</strong>
      <div style="text-align: center;">
        <img id="escudo2" src="" alt="Equipo 2" style="width: 60px; height: 60px;"><br>
        <span id="nombreEquipo2"></span>
      </div>
    </div>

    <p style="margin-top: 20px; text-align: center;">Nombrá jugadores que hayan pasado por ambos clubes.</p>

    <div class="input-jugador-container" style="text-align: center;">
      <input type="text" id="jugadorInput" placeholder="Nombre del jugador" />
      <button onclick="verificarJugador()">→</button>
    </div>
    <p id="mensajeJugador" style="color: red; text-align: center;"></p>
    <ul id="jugadoresCorrectos" style="list-style: none; padding: 0; margin-top: 20px; text-align: center;"></ul>
    <p id="contadorJugadores" style="margin-top: 10px; text-align: center;">Jugadores Encontrados: 0/X</p>
  </div>

  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';
    import { getFirestore, collection, query, where, getDocs, doc, setDoc } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js';

    const firebaseConfig = {
      apiKey: "AIzaSyCmKCofXzl05FtXPF5doBMvCf-rY-0aGFE",
      authDomain: "futbol-11-argentino-16892.firebaseapp.com",
      projectId: "futbol-11-argentino-16892",
      storageBucket: "futbol-11-argentino-16892.appspot.com",
      messagingSenderId: "266321510777",
      appId: "1:266321510777:web:2d9a6441cf49e897ceafa8"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    let jugadoresValidos = [];
    let jugadoresEncontrados = [];
    let cantidad = 0;
    let fechaDesafio = "";

    const usuario = JSON.parse(localStorage.getItem("usuarioActual"));

    document.getElementById("modoNormal").addEventListener("click", () => {
      document.getElementById("introContainer").style.display = "none";
      document.getElementById("juegoContainer").style.display = "block";
      cargarDesafioDiario();
    });

    async function cargarDesafioDiario() {
      fechaDesafio = new Date().toISOString().slice(0, 10);
      const q = query(collection(db, "juegos/juego1/desafios-diarios"), where("fecha", "==", fechaDesafio));
      const snapshot = await getDocs(q);
      if (!snapshot.empty) {
        const data = snapshot.docs[0].data();
        document.getElementById("nombreEquipo1").textContent = data.equipo1;
        document.getElementById("nombreEquipo2").textContent = data.equipo2;
        document.getElementById("escudo1").src = `img/escudos equipos/A/${data.equipo1}.png`;
        document.getElementById("escudo2").src = `img/escudos equipos/A/${data.equipo2}.png`;
        jugadoresValidos = data.jugadores || [];
        cantidad = data.cantidad || jugadoresValidos.length;
        actualizarContador();
      }
    }

    window.verificarJugador = async function () {
      const input = document.getElementById("jugadorInput");
      const mensaje = document.getElementById("mensajeJugador");
      const lista = document.getElementById("jugadoresCorrectos");
      const jugador = input.value.trim();
      if (!jugador) return;

      if (!jugadoresValidos.includes(jugador)) {
        mensaje.textContent = 'El jugador no jugó en ambos clubes.';
        return;
      }

      if (jugadoresEncontrados.includes(jugador)) {
        mensaje.textContent = 'Ya nombraste a ese jugador.';
        return;
      }

      jugadoresEncontrados.push(jugador);
      mensaje.textContent = '';
      const li = document.createElement("li");
      li.textContent = jugador;
      lista.appendChild(li);
      input.value = '';
      actualizarContador();

      if (jugadoresEncontrados.length >= cantidad) {
        await guardarDesafioCompletado();

        const popup = document.createElement('div');
        popup.style.position = 'fixed';
        popup.style.top = '50%';
        popup.style.left = '50%';
        popup.style.transform = 'translate(-50%, -50%)';
        popup.style.background = '#fff';
        popup.style.padding = '20px';
        popup.style.borderRadius = '10px';
        popup.innerHTML = `
          <h3>¡Completaste el desafío diario!</h3>
          <button onclick="window.location.href='index.html'">Inicio</button>
        `;
        document.body.appendChild(popup);
      }
    }

    async function guardarDesafioCompletado() {
      if (!usuario || !usuario.usuario) return;
      const id = `juego1-${fechaDesafio}`;
      const docRef = doc(db, `usuarios/${usuario.usuario}/desafiosCompletados`, id);
      await setDoc(docRef, {
        juego: "juego1",
        fecha: fechaDesafio,
        jugadores: jugadoresEncontrados
      });
    }

    function actualizarContador() {
      const contador = document.getElementById("contadorJugadores");
      contador.textContent = `Jugadores Encontrados: ${jugadoresEncontrados.length}/${cantidad}`;
    }
  </script>
</body>
</html>
