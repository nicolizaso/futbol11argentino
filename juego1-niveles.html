<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Niveles - Jugadores en Común</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Anton&family=Rubik&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/styles.css">

  <!-- Firebase compat para usar en HTML sin módulos -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
</head>
<body>
  <header>Fútbol 11 Argentino</header>

  <div class="container" style="text-align: center;">
    <div style="display: flex; justify-content: space-between; align-items: center;">
      <a id="botonAtras" href="juego1.html" style="color: #ffffff; text-decoration: underline; margin: 10px;">Atrás</a>
      <h1 class="titulo-juego">Niveles</h1>
      <div style="width: 60px;"></div>
    </div>

    <div id="tablaNiveles" style="display: flex; justify-content: center; overflow-x: hidden;">
      <table>
        <thead>
          <tr>
            <th>Equipo</th>
            <th>Nivel 1</th>
            <th>Nivel 2</th>
            <th>Nivel 3</th>
            <th>Nivel 4</th>
            <th>Nivel 5</th>
            <th>Nivel 6</th>
            <th>Nivel 7</th>
            <th>Nivel 8</th>
            <th>Nivel 9</th>
            <th>Nivel 10</th>
          </tr>
        </thead>
        <tbody>
          <tr><td>River Plate</td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td></tr>
          <tr><td>Boca Juniors</td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td></tr>
          <tr><td>Independiente</td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td></tr>
          <tr><td>Racing Club</td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td></tr>
          <tr><td>San Lorenzo</td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td></tr>
          <tr><td>Huracán</td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td></tr>
        </tbody>
      </table>
    </div>

    <p id="contadorCompletados" style="margin-top: 20px; font-size: 20px;">Completados: <span id="completados">0</span>/60</p>

    <div id="selectores" style="margin-top: 20px; display: flex; justify-content: center; gap: 20px;">
      <div>
        <label for="selectorEquipo">Equipo:</label><br>
        <select id="selectorEquipo">
          <option value="River">River Plate</option>
          <option value="Boca">Boca Juniors</option>
          <option value="Independiente">Independiente</option>
          <option value="Racing">Racing Club</option>
          <option value="San Lorenzo">San Lorenzo</option>
          <option value="Huracan">Huracán</option>
        </select>
      </div>
      <div>
        <label for="selectorNivel">Nivel:</label><br>
        <select id="selectorNivel">
          <option value="1">Nivel 1</option>
          <option value="2">Nivel 2</option>
          <option value="3">Nivel 3</option>
          <option value="4">Nivel 4</option>
          <option value="5">Nivel 5</option>
          <option value="6">Nivel 6</option>
          <option value="7">Nivel 7</option>
          <option value="8">Nivel 8</option>
          <option value="9">Nivel 9</option>
          <option value="10">Nivel 10</option>
        </select>
      </div>
    </div>

    <div style="margin-top: 20px;" id="botonComenzar">
      <button id="btnComenzar">Comenzar</button>
    </div>

    <div id="juegoContainer" style="margin-top: 40px;"></div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCmKCofXzl05FtXPF5doBMvCf-rY-0aGFE",
      authDomain: "futbol-11-argentino-16892.firebaseapp.com",
      projectId: "futbol-11-argentino-16892",
      storageBucket: "futbol-11-argentino-16892.appspot.com",
      messagingSenderId: "266321510777",
      appId: "1:266321510777:web:2d9a6441cf49e897ceafa8"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const checkboxes = document.querySelectorAll('input[type="checkbox"]');
    const completadosSpan = document.getElementById('completados');
    const tablaNiveles = document.getElementById('tablaNiveles');
    const selectores = document.getElementById('selectores');
    const botonComenzar = document.getElementById('botonComenzar');
    const contadorCompletados = document.getElementById('contadorCompletados');
    const botonAtras = document.getElementById('botonAtras');

    let jugadoresTotales = [];
    let jugadoresEncontrados = [];

    checkboxes.forEach(cb => {
      cb.addEventListener('change', () => {
        const total = Array.from(checkboxes).filter(c => c.checked).length;
        completadosSpan.textContent = total;
      });
    });

    document.getElementById("btnComenzar").addEventListener("click", comenzarNivel);

    async function comenzarNivel() {
      const equipoOriginal = document.getElementById('selectorEquipo').value;
      const nivel = document.getElementById('selectorNivel').value;
      const juegoContainer = document.getElementById('juegoContainer');

      const equipoID = equipoOriginal.replace(/\s+/g, '');

      tablaNiveles.style.display = 'none';
      selectores.style.display = 'none';
      botonComenzar.style.display = 'none';
      contadorCompletados.style.display = 'none';
      botonAtras.href = 'juego1-niveles.html';

      try {
        const nivelRef = db.doc(`juegos/juego1/niveles/${equipoID}/Nivel/Nivel${nivel}`);
        const docSnap = await nivelRef.get();

        if (docSnap.exists) {
          const data = docSnap.data();
          const equipo1 = data.equipo1;
          const equipo2 = data.equipo2;
          jugadoresTotales = data.jugadores || [];

          juegoContainer.innerHTML = `
            <h3>${equipoOriginal} - Nivel ${nivel}</h3>
            <p>${equipo1} vs ${equipo2}</p>
            <p>Nombrá jugadores que hayan pasado por ambos clubes.</p>
            <div class="input-jugador-container">
            <input type="text" id="jugadorInput" placeholder="Nombre del jugador" />
            <button onclick="enviarJugador()">→</button>
            </div>

            <p id="mensajeJugador" style="color: red;"></p>
            <ul id="jugadoresCorrectos" style="list-style: none; padding: 0; margin-top: 20px;"></ul>
          `;
        } else {
          juegoContainer.innerHTML = "<p>No se encontró el nivel en la base de datos.</p>";
        }
      } catch (error) {
        console.error("Error al cargar el nivel:", error);
        juegoContainer.innerHTML = "<p>Error al cargar el nivel.</p>";
      }
    }
async function guardarNivelCompletado(equipo, nivel) {
      const user = auth.currentUser;
      if (!user) return;
      const username = user.displayName || user.email.split("@")[0];

      try {
        await db.collection("juegos")
          .doc("juego1")
          .collection("nivelesCompletados")
          .doc(username)
          .set({ [`${equipo}_Nivel${nivel}`]: true }, { merge: true });
        console.log("Nivel guardado como completado en la base de datos");
      } catch (error) {
        console.error("Error al guardar el nivel completado:", error);
      }
    }
    function enviarJugador() {
      const input = document.getElementById('jugadorInput');
      const mensaje = document.getElementById('mensajeJugador');
      const lista = document.getElementById('jugadoresCorrectos');

      const jugador = input.value.trim();
      if (!jugador) return;

      if (!jugadoresTotales.includes(jugador)) {
        mensaje.textContent = 'El jugador no jugó en ambos clubes.';
        return;
      }

      if (jugadoresEncontrados.includes(jugador)) {
        mensaje.textContent = 'Ya nombraste a ese jugador.';
        return;
      }

      jugadoresEncontrados.push(jugador);
      mensaje.textContent = '';

      const li = document.createElement('li');
      li.textContent = jugador;
      lista.appendChild(li);
      input.value = '';

      if (jugadoresEncontrados.length >= jugadoresTotales.length) {
        const popup = document.createElement('div');
        popup.style.position = 'fixed';
        popup.style.top = '50%';
        popup.style.left = '50%';
        popup.style.transform = 'translate(-50%, -50%)';
        popup.style.background = '#fff';
        popup.style.padding = '20px';
        popup.style.borderRadius = '10px';
        popup.innerHTML = `
          <h3>Completaste el nivel "${document.querySelector('h3').textContent}"</h3>
          <button onclick="window.location.href='juego1-niveles.html'">Niveles</button>
          <button onclick="window.location.href='index.html'">Inicio</button>
        `;
        document.body.appendChild(popup);
      }
    }
  </script>
</body>
</html>
