<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Panel de Administración - Fútbol 11 Argentino</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Anton&family=Rubik&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/styles.css">

  <style>
    .success-message {
      color: #00ff99;
      font-weight: bold;
      margin-top: 10px;
      text-align: center;
    }
  </style>

  <style>
    .success-message {
      color: #00ff99;
      font-weight: bold;
      margin-top: 10px;
      text-align: center;
    }
  </style>

  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';
    import { getFirestore, collection, doc, setDoc } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js';
    import * as XLSX from 'https://cdn.sheetjs.com/xlsx-0.20.0/package/xlsx.mjs';

    const firebaseConfig = {
      apiKey: "AIzaSyCmKCofXzl05FtXPF5doBMvCf-rY-0aGFE",
      authDomain: "futbol-11-argentino-16892.firebaseapp.com",
      projectId: "futbol-11-argentino-16892",
      storageBucket: "futbol-11-argentino-16892.firebasestorage.app",
      messagingSenderId: "266321510777",
      appId: "1:266321510777:web:2d9a6441cf49e897ceafa8",
      measurementId: "G-GKTXCJ5K74"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    window.guardarDesafio = async function guardarDesafio() {
      const juego = document.getElementById('juego').value;
      const fecha = document.getElementById('fecha').value;
      const equipo1 = document.getElementById('equipo1').value;
      const equipo2 = document.getElementById('equipo2').value;
      const jugadores = document.getElementById('jugadores').value.split(',').map(j => j.trim());
      const cantidad = parseInt(document.getElementById('cantidadJugadoresDesafio').value);

      if (!fecha || !juego || !equipo1 || !equipo2 || jugadores.length === 0) {
        alert('Completá todos los campos.');
        return;
      }

      const [yyyy, mm, dd] = fecha.split('-');
      const docId = `Juego${juego.split('-').pop()}-${dd}-${mm}-${yyyy}`;

      try {
        await setDoc(doc(db, `juegos/${juego}/desafios-diarios/${docId}`), {
          juego,
          fecha,
          equipo1,
          equipo2,
          jugadores,
          cantidad
        });
        document.getElementById('mensajeConfirmacion').textContent = '✅ Desafío guardado correctamente';
        document.getElementById('mensajeConfirmacion').style.display = 'block';
        setTimeout(() => window.location.reload(), 1500);
      } catch (error) {
        console.error('Error al guardar desafío:', error);
        alert('Hubo un error al guardar el desafío.');
      }
    }

    window.guardarNivel = async function guardarNivel() {
      const juego = document.getElementById('nivelJuego').value;
      const nombre = document.getElementById('nivelNombre').value.trim();
      const equipo1 = document.getElementById('nivelEquipo1').value;
      const equipo2 = document.getElementById('nivelEquipo2').value;
      const jugadores = document.getElementById('nivelJugadores').value.split(',').map(j => j.trim());
      const cantidad = parseInt(document.getElementById('cantidadJugadoresNivel').value);

      if (!nombre || !juego || !equipo1 || !equipo2 || jugadores.length === 0) {
        alert('Completá todos los campos.');
        return;
      }

      const equipoKey = equipo1.trim().replace(/\s+/g, '');
      const nivelKey = nombre.trim().replace(/\s+/g, '');

      try {
        await setDoc(doc(db, `juegos/${juego}/niveles/${equipoKey}/Nivel/${nivelKey}`), {
          juego,
          nombre,
          equipo1,
          equipo2,
          jugadores,
          cantidad
        });
        document.getElementById('mensajeConfirmacion').textContent = '✅ Nivel guardado correctamente';
        document.getElementById('mensajeConfirmacion').style.display = 'block';
        setTimeout(() => window.location.reload(), 1500);
      } catch (error) {
        console.error('Error al guardar nivel:', error);
        alert('Hubo un error al guardar el nivel.');
      }
    }

    window.guardarEquipo = async function guardarEquipo() {
      const nombre = document.getElementById('equipoNombre').value.trim();
      const ciudad = document.getElementById('equipoCiudad').value.trim();
      const torneo = document.getElementById('equipoTorneo').value.trim();
      const imagen = document.getElementById('equipoImagen').value.trim() || nombre;

      if (!nombre || !ciudad || !torneo) {
        alert('Completá todos los campos.');
        return;
      }

      const equipoID = nombre.replace(/\s+/g, '');

      try {
        await setDoc(doc(db, "equipos", equipoID), {
          nombre,
          ciudad,
          torneo,
          imagen
        });
        document.getElementById('mensajeConfirmacion').textContent = '✅ Equipo guardado correctamente';
        document.getElementById('mensajeConfirmacion').style.display = 'block';
        setTimeout(() => window.location.reload(), 1500);
      } catch (error) {
        console.error('Error al guardar equipo:', error);
        alert('Hubo un error al guardar el equipo.');
      }
    }

    window.importarEquiposDesdeExcel = async function importarEquiposDesdeExcel(event) {
      const file = event.target.files[0];
      if (!file) return;

      const data = await file.arrayBuffer();
      const workbook = XLSX.read(data);
      const sheetName = workbook.SheetNames[0];
      const sheet = workbook.Sheets[sheetName];
      const equipos = XLSX.utils.sheet_to_json(sheet);

      for (const equipo of equipos) {
        const nombre = equipo.nombre?.trim();
        const ciudad = equipo.ciudad?.trim();
        const torneo = equipo.torneo?.trim();
        const imagen = equipo.imagen?.trim() || nombre;
        if (!nombre || !ciudad || !torneo) continue;
        const equipoID = nombre.replace(/\s+/g, '');
        await setDoc(doc(db, "equipos", equipoID), { nombre, ciudad, torneo, imagen });
      }

      alert('✅ Equipos cargados correctamente');
      setTimeout(() => window.location.reload(), 1500);
    }
    window.importarJugadoresDesdeExcel = async function importarJugadoresDesdeExcel(event) {
      const file = event.target.files[0];
      if (!file) return;

      const data = await file.arrayBuffer();
      const workbook = XLSX.read(data);
      const sheetName = workbook.SheetNames[0];
      const sheet = workbook.Sheets[sheetName];
      const jugadores = XLSX.utils.sheet_to_json(sheet);

      for (const jugador of jugadores) {
        const nombre = jugador.nombre?.trim();
        const equipo = jugador.equipo?.trim();
        const liga = jugador.liga?.trim();
        const puesto = jugador.puesto?.trim();
        const edad = parseInt(jugador.edad);
        const nacionalidad = jugador.nacionalidad?.trim();

        if (!nombre || !equipo || !liga || !puesto || isNaN(edad) || !nacionalidad) continue;
        const jugadorID = nombre.replace(/\s+/g, '_').toLowerCase();

        await setDoc(doc(db, "jugadores", jugadorID), {
          nombre,
          equipo,
          liga,
          puesto,
          edad,
          nacionalidad
        });
      }

      alert('✅ Jugadores cargados correctamente');
      setTimeout(() => window.location.reload(), 1500);
    }
  </script>
</head>
<body>
  <div id="mensajeConfirmacion" class="success-message" style="display: none;"></div>

  <div class="container">
    <h1>Panel de Administración</h1>

    <div class="section">
      <h2>Desafío Diario</h2>
      <label for="juego">Juego:</label>
      <select id="juego">
        <option value="juego1">Jugadores en Común</option>
      </select>

      <label for="fecha">Fecha del desafío diario:</label>
      <input type="date" id="fecha">

      <label for="equipo1">Equipo 1:</label>
      <input type="text" id="equipo1">

      <label for="equipo2">Equipo 2:</label>
      <input type="text" id="equipo2">

      <label for="jugadores">Jugadores válidos (separados por coma):</label>
      <textarea id="jugadores"></textarea>
      
      <label for="cantidadJugadoresDesafio">Cantidad de Jugadores:</label>
      <input type="number" id="cantidadJugadoresDesafio" min="1">

      <button onclick="guardarDesafio()">Guardar desafío diario</button>
    </div>

    <div class="section">
      <h2>Crear Nivel</h2>
      <label for="nivelJuego">Juego:</label>
      <select id="nivelJuego">
        <option value="juego1">Jugadores en Común</option>
      </select>

      <label for="nivelNombre">Nombre del nivel:</label>
      <input type="text" id="nivelNombre">

      <label for="nivelEquipo1">Equipo 1:</label>
      <input type="text" id="nivelEquipo1">

      <label for="nivelEquipo2">Equipo 2:</label>
      <input type="text" id="nivelEquipo2">

      <label for="nivelJugadores">Jugadores válidos (separados por coma):</label>
      <textarea id="nivelJugadores"></textarea>
      <label for="cantidadJugadoresNivel">Cantidad de Jugadores:</label>
      <input type="number" id="cantidadJugadoresNivel" min="1">

      <button onclick="guardarNivel()">Guardar nivel</button>
    </div>

    <div class="section">
      <h2>Cargar Equipo</h2>

      <label for="equipoNombre">Nombre del equipo:</label>
      <input type="text" id="equipoNombre" placeholder="Ej: River Plate">

      <label for="equipoCiudad">Ciudad o localidad:</label>
      <input type="text" id="equipoCiudad" placeholder="Ej: Buenos Aires">

      <label for="equipoTorneo">Torneo:</label>
      <input type="text" id="equipoTorneo" placeholder="Ej: Liga Profesional">

      <label for="equipoImagen">Nombre de imagen (sin extensión):</label>
      <input type="text" id="equipoImagen" placeholder="Ej: River Plate">

      <button onclick="guardarEquipo()">Guardar equipo</button>

      <hr>
      <label for="archivoExcel">Carga masiva desde Excel:</label>
      <input type="file" id="archivoExcel" accept=".xls,.xlsx" onchange="importarEquiposDesdeExcel(event)">
    </div>
    <div class="section">
      <h2>Cargar Jugadores</h2>
      <label for="archivoJugadores">Archivo Excel de jugadores:</label>
      <input type="file" id="archivoJugadores" accept=".xls,.xlsx" onchange="importarJugadoresDesdeExcel(event)">
      <p>Debe tener las columnas: nombre, equipo, liga, puesto, edad, nacionalidad</p>
    </div>
  </div>
</body>
</html>
